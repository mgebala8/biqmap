function _excel(){this.list=null,this.parse_file=null,this.id=null,this.check=function(){null==this.list?this.get_files():("excel"==popup.target_name&&this.show_files(),"project-excel"==popup.target_name&&this.project_show_files())},this.get_files=function(){var e=this;$.ajax({url:"/rest/excel",type:"GET",data:{authenticity_token:authenticity_token},success:function(t){e.list=t,"excel"==popup.target_name&&e.show_files(),"project-excel"==popup.target_name&&e.project_show_files()}})},this.show_files=function(){var e=this;$("#excel .excel_list").html(""),$.each(this.list,function(t,i){$("#excel .excel_list").append('<div class="file" id="'+i.id+'" ><span>'+i.name+"</span></div>"),$("#excel .excel_list .file:last-child").delay(80*t).fadeIn(200),e.index=t}),$("#excel .excel_list").css("background","none"),$("#excel .excel_list").append('<div class="file add"><span>nowy plik</span></div>'),$("#excel .excel_list div:last-child").delay(80*this.index).fadeIn(200)},this.project_show_files=function(){var e=this;$("#project-excel .excel_list").html(""),$.each(this.list,function(t,i){$("#project-excel .excel_list").append(project.excel_id==i.id?'<div class="file" style="border-top:5px solid red" id="'+i.id+'" ><span>'+i.name+"</span></div>":'<div class="file" id="'+i.id+'" ><span>'+i.name+"</span></div>"),$("#project-excel .excel_list .file:last-child").delay(80*t).fadeIn(200),e.index=t}),$("#project-excel .excel_list").css("background","none"),$("#project-excel .excel_list").append('<div class="file add"><span>nowy plik</span></div>'),$("#project-excel .excel_list div:last-child").delay(80*this.index).fadeIn(200)},this["delete"]=function(){var e=this;$.ajax({url:"/rest/excel/"+e.id,type:"DELETE",data:{authenticity_token:authenticity_token},success:function(){e.get_files()}})},this.show_table=function(){alert(this.parse_file);for(var e='<button onClick="excel.update()">zapisz zmiany</button><button onClick="excel.delete()">usu\u0144 plik</button><button onClick="excel.show_files()">wr\xf3\u0107 do listy</button><table border="1">',t="<tr>",i=0;i<this.parse_file[0].length;i++)t+="<th>"+this.parse_file[0][i]+"</th>";t+="</tr>",e+=t;for(var s=1;s<this.parse_file.length;s++){for(var t="<tr>",i=0;i<this.parse_file[s].length;i++)t+='<td><input class="table_input" onkeyup="excel.change(this)" type="text" row="'+s+'" column="'+i+'" value="'+this.parse_file[s][i]+'" /></td>';t+="</tr>",e+=t}e+="</table>",$(".excel_list").html(e)},this.project_show_table=function(){layers.show();for(var e='<table border="1">',t="<tr>",i=0;i<this.parse_file[0].length;i++)t+="<th><span>"+this.parse_file[0][i]+"</span></th>";t+="</tr>",e+=t;for(var s=1;s<this.parse_file.length;s++){for(var t="<tr>",i=0;i<this.parse_file[s].length;i++)t+='<td><span class="table_input" type="text" row="'+s+'" column="'+i+'" value="'+this.parse_file[s][i]+'">'+this.parse_file[s][i]+"</span>";t+="</tr>",e+=t}e+="</table>",$("#project-edit .wrapper .container .excel_window .table").html(e)},this.get_file=function(e){this.id=e;var t=this;$.ajax({url:"/rest/excel/"+e,type:"GET",data:{authenticity_token:authenticity_token},success:function(e){t.set_parse_file(JSON.parse(e.excel_json)),t.show_table()}})},this.set_parse_file=function(e){for(var t=0;t<=e.length;t++)for(var i=0;i<e[1].length;i++)try{"undefined"==typeof e[t][i]&&(e[t][i]="")}catch(s){}this.parse_file=e},this.project_get_file=function(e){this.id=e;var t=this;$.ajax({url:"/rest/excel/"+e,type:"GET",data:{authenticity_token:authenticity_token},success:function(e){t.set_parse_file(JSON.parse(e.excel_json)),t.project_show_table()}})},this.table_reset=function(){$(".excel_window table tr input").each(function(e,t){var i=$(t).val();$(t).parent().css("background","white"),$(t).parent().html("<span>"+i+"</span>")})},this.table_change=function(e){this.table_reset();var t=$(e).html(),i=$(e).parent();$(i).html('<input type="text" value="'+t+'"/>'),$(i).css("background","blue"),$(i).children("input").focus()},this.update=function(){var e=this;$.ajax({url:"/rest/excel/"+e.id,type:"PUT",data:{excel_json:JSON.stringify(e.parse_file),authenticity_token:authenticity_token},success:function(e){console.log(e)},error:function(e){console.log(e)}})}}